angular.module("sample",["ngRoute","ngCkeditor","sample.user","sample.search","sample.common","sample.detail","ui.bootstrap","gd.ui.jsonexplorer","sample.create","sample.createTriples","sample.loadData","sample.getReviews","sample.owedRevenue","sample.taxIncentives","sample.brandRevenue","sample.lifestyleRevenue"]).config(["$routeProvider","$locationProvider",function(e,t){"use strict";t.html5Mode(!0),e.when("/",{templateUrl:"/search/search.html"}).when("/create",{templateUrl:"/create/create.html",controller:"CreateCtrl"}).when("/createTriples",{templateUrl:"/create/createTriples.html",controller:"CreateTriplesCtrl"}).when("/detail",{templateUrl:"/detail/detail.html",controller:"DetailCtrl"}).when("/profile",{templateUrl:"/user/profile.html",controller:"ProfileCtrl"}).when("/loadData",{templateUrl:"/create/loadData.html",controller:"LoadDataCtrl"}).when("/agentOntology",{templateUrl:"/agentOntology.html"}).when("/owedRevenue",{templateUrl:"/owedRevenue/owedRevenue.html",controller:"OwedRevenueCtrl"}).when("/taxIncentives",{templateUrl:"/taxIncentives/taxIncentives.html",controller:"TaxIncentivesCtrl"}).when("/brandRevenue",{templateUrl:"/brandRevenue/brandRevenue.html",controller:"BrandRevenueCtrl"}).when("/lifestyleRevenue",{templateUrl:"/lifestyleRevenue/lifestyleRevenue.html",controller:"LifestyleRevenueCtrl"}).otherwise({redirectTo:"/"})}]).filter("decode",function(){return window.decodeURIComponent});var module=angular.module("sample.common",[]);module.filter("object2Array",function(){"use strict";return function(e){var t=[];for(var r in e)e[r].__key=r,t.push(e[r]);return t}}),function(){"use strict";angular.module("sample.brandRevenue").controller("BrandRevenueCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={detail:{},user:n};angular.extend(e,{model:a,submit:function(){t.brandRevenue(e.model.user).then(function(e){a.detail=e})}})}])}(),angular.module("sample.brandRevenue",[]),angular.module("sample.create").directive("compile",function(e){"use strict";return function(t,r,n){t.$watch(function(e){return e.$eval(n.compile)},function(n){r.html(n),e(r.contents())(t)})}}),function(){"use strict";angular.module("sample.create").controller("CreateCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={person:{isActive:!0,balance:0,picture:"http://placehold.it/32x32",age:0,eyeColor:"",name:"",gender:"",company:"",email:"",phone:"",address:"",about:"",registered:"",latitude:0,longitude:0,tags:[],friends:[],greeting:"",favoriteFruit:""},newTag:"",user:n};angular.extend(e,{model:a,editorOptions:{height:"100px",toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"}],toolbar:"",toolbar_full:""},submit:function(){t.createDocument(e.model.person,{format:"json",directory:"/content/",extension:".json"}).then(function(e){r.location.href="/detail?uri="+e.headers("location").replace(/(.*\?uri=)/,"")})},addTag:function(){a.person.tags.push(a.newTag),a.newTag=""}})}])}(),angular.module("sample.create",[]),function(){"use strict";angular.module("sample.createTriples").controller("CreateTriplesCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={triple:{subject:"",predicate:"",object:""},user:n};angular.extend(e,{model:a,submit:function(){t.createTriple(e.model.triple,{format:"json",directory:"/triples/",extension:".json",subject:e.model.triple.subject,predicate:e.model.triple.predicate,object:e.model.triple.object}).then(function(){r.location.href="/"})}})}])}(),angular.module("sample.createTriples",[]),function(){"use strict";angular.module("sample.getReviews").controller("GetReviewsCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={movieData:{movie:""},user:n};angular.extend(e,{model:a,editorOptions:{height:"100px",toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"}],toolbar:"",toolbar_full:""},submit:function(){t.callExtension("getReviews",{method:"GET",data:a.movieData.movie,user:n,params:{movie:a.movieData.movie},headers:{"Content-Type":"application/text"}}).then(function(){console.log("Got Movie"),r.location.href="/"})}})}])}(),angular.module("sample.getReviews",[]),function(){"use strict";angular.module("sample.loadData").controller("LoadDataCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={topicAndSentiment:{topic:"",sentiment:"",posOrNeg:""},user:n};angular.extend(e,{model:a,editorOptions:{height:"100px",toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"}],toolbar:"",toolbar_full:""},submit:function(){t.createSentiment(e.model.topicAndSentiment,{format:"xml",directory:"/sentiments/",extension:".xml",topic:e.model.topicAndSentiment.topic,sentiment:e.model.topicAndSentiment.sentiment,posOrNeg:e.model.topicAndSentiment.posOrNeg}).then(function(){r.location.href="/"})}})}])}(),angular.module("sample.loadData",[]),function(){"use strict";var e=angular.module("sample.detail");e.directive("actors",[function(){return{restrict:"E",templateUrl:"/detail/actors-dir.html"}}])}(),function(){"use strict";var e=angular.module("sample.detail");e.directive("adhoc",[function(){return{restrict:"E",templateUrl:"/detail/adhoc-dir.html"}}])}(),function(){"use strict";angular.module("sample.detail").controller("DetailCtrl",["$scope","MLRest","$routeParams",function(e,t,r){var n=r.uri,a={detail:{}};t.getDocument(n,{format:"json"}).then(function(e){a.detail=e.data,"actorTweetMode"===a.detail.modeFlag||"movieTweetMode"===a.detail.modeFlag?(a.mode="tweet",console.log("mode is tweet")):"reviewMode"===a.detail.modeFlag?(a.mode="review",console.log("mode is review")):"movieMode"===a.detail.modeFlag?(a.mode="movie",console.log("mode is movie")):"adHocMode"===a.detail.modeFlag?(a.mode="actor",console.log("mode is adhoc but setting directive to actor for now")):(a.mode="actor",console.log("mode is actor"))}),angular.extend(e,{model:a})}])}(),angular.module("sample.detail",[]),function(){"use strict";var e=angular.module("sample.detail");e.directive("movies",[function(){return{restrict:"E",templateUrl:"/detail/movies-dir.html"}}])}(),function(){"use strict";var e=angular.module("sample.detail");e.directive("reviews",[function(){return{restrict:"E",templateUrl:"/detail/reviews-dir.html"}}])}(),function(){"use strict";var e=angular.module("sample.detail");e.directive("tweets",[function(){return{restrict:"E",templateUrl:"/detail/tweets-dir.html"}}])}(),function(){"use strict";var e=angular.module("sample.detail");e.directive("tweetsmovies",[function(){return{restrict:"E",templateUrl:"/detail/tweetsmovies-dir.html"}}])}(),function(){"use strict";angular.module("sample.lifestyleRevenue").controller("LifestyleRevenueCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={detail:{},user:n};angular.extend(e,{model:a,submit:function(){t.lifestyleRevenue(e.model.user).then(function(e){a.detail=e})}})}])}(),angular.module("sample.lifestyleRevenue",[]),function(){"use strict";angular.module("sample.owedRevenue").controller("OwedRevenueCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={detail:{},user:n};angular.extend(e,{model:a,submit:function(){t.owedRevenue(e.model.user).then(function(e){a.detail=e})}})}])}(),angular.module("sample.owedRevenue",[]),function(){"use strict";angular.module("sample.search").filter("object2Array",function(){return function(e){var t=[];for(var r in e)e[r].__key=r,t.push(e[r]);return t}}).directive("facets",[function(){return{restrict:"E",scope:{facets:"=facetList",selected:"=selected",select:"&select",clear:"&clear"},templateUrl:"/search/facets-dir.html",link:function(){}}}])}(),function(){"use strict";var e=angular.module("sample.search");e.directive("results",[function(){return{restrict:"E",scope:{results:"=resultList",total:"=total",start:"=start",pageLength:"=pageLength",currentPage:"=currentPage",paginate:"&paginate",updateQuery:"&updateQuery"},templateUrl:"/search/results-dir.html",link:function(e){e.Math=window.Math}}}])}(),function(){"use strict";angular.module("sample.search").controller("SearchCtrl",["$scope","MLRest","User","$location",function(e,t,r,n){function a(e){o.search=e}var o={selected:[],text:"",user:r},l=t.createSearchContext();!function(){l.search().then(a)}(),angular.extend(e,{model:o,selectFacet:function(e,t){var r=o.selected.filter(function(r){return r.facet===e&&r.value===t});0===r.length&&(o.selected.push({facet:e,value:t}),l.selectFacet(e,t).search().then(a))},clearFacet:function(e,t){var r;for(r=0;r<o.selected.length;r++)if(o.selected[r].facet===e&&o.selected[r].value===t){o.selected.splice(r,1);break}l.clearFacet(e,t).search().then(a)},textSearch:function(){l.setText(o.text).search().then(a),n.path("/")},pageChanged:function(e){l.setPage(e,o.pageLength).search().then(a)},getSuggestions:function(e){return t.callExtension("extsuggest",{method:"GET",params:{"rs:pqtxt":e,"rs:options":"all"}}).then(function(e){return e.suggestions})}}),e.$watch("model.user.authenticated",function(){l.search().then(a,function(){o.search={}})})}])}(),angular.module("sample.search",[]),function(){"use strict";angular.module("sample.taxIncentives").controller("TaxIncentivesCtrl",["$scope","MLRest","$window","User",function(e,t,r,n){var a={detail:{},user:n};angular.extend(e,{model:a,submit:function(){t.taxIncentives(e.model.user).then(function(e){a.detail=e})}})}])}(),angular.module("sample.taxIncentives",[]),function(){"use strict";angular.module("sample.user").controller("ProfileCtrl",["$scope","MLRest","User","$location",function(e,t,r,n){var a={user:r,newEmail:""};angular.extend(e,{model:a,addEmail:function(){e.profileForm.newEmail.$error.email||(e.model.user.emails||(e.model.user.emails=[]),e.model.user.emails.push(a.newEmail),a.newEmail="")},removeEmail:function(t){e.model.user.emails.splice(t,1)},submit:function(){t.updateDocument({user:{fullname:e.model.user.fullname,emails:e.model.user.emails}},{format:"json",uri:"/users/"+e.model.user.name+".json"}).then(function(){n.path("/")})}})}])}(),function(){"use strict";var e=angular.module("sample.user");e.directive("mlUser",[function(){return{restrict:"A",controller:"UserController",replace:!0,scope:{username:"=username",password:"=password",authenticated:"=authenticated",login:"&login",logout:"&logout",loginerror:"=loginerror"},templateUrl:"/user/user-dir.html",link:function(){}}}]).controller("UserController",["$scope","User","$http","$location",function(e,t,r,n){angular.extend(e,{login:function(e,a){r.get("/user/login",{params:{username:e,password:a}}).then(function(e){t.authenticated=e.data.authenticated,t.authenticated===!0?(t.loginError=!1,void 0!==e.data.profile?(t.fullname=e.data.profile.fullname,t.emails=e.data.profile.emails):n.path("/profile")):t.loginError=!0})},logout:function(){r.get("/user/logout",{}).then(function(){t.init()})}})}])}(),function(){"use strict";angular.module("sample.user").factory("User",["$http",function(e){function t(e){var t=e.data;t.authenticated===!0&&(r.name=t.username,r.authenticated=!0,void 0!==t.profile&&(r.hasProfile=!0,r.fullname=t.profile.fullname,r.emails=$.isArray(t.profile.emails)?t.profile.emails:[t.profile.emails]))}var r={};return e.get("/user/status",{}).then(t),r.init=function(){return r.name="",r.password="",r.loginError=!1,r.authenticated=!1,r.hasProfile=!1,r.fullname="",r.emails=[],r},r}])}(),angular.module("sample.user",["sample.common"]),function(){"use strict";angular.module("sample.common").provider("MLRest",function(){function e(e){var t,r,n,a,o=[],l={};for(var s in e)if(e.hasOwnProperty(s)){l={};for(a in e[s])if(e[s].hasOwnProperty(a))if("metadata"===a){t={};for(r in e[s].metadata)if(e[s].metadata.hasOwnProperty(r))for(n in e[s].metadata[r])e[s].metadata[r].hasOwnProperty(n)&&(t[n]?t[n].push(e[s].metadata[r][n]):t[n]=[e[s].metadata[r][n]]);l.metadata=t}else l[a]=e[s][a];o.push(l)}return o}function t(t,r,n){function a(){var a=r.defer();return n.get("/v1/search",{params:{format:"json",options:t.queryOptions,structuredQuery:l(),start:d,pageLength:t.pageLength}}).success(function(t){t.results=e(t.results),a.resolve(t)}).error(function(e){a.reject(e)}),a.promise}function o(e){var r;for(r in i)i.hasOwnProperty(r)&&i[r].length>0&&e.push("Dataset"===r?{"collection-constraint-query":{"constraint-name":"Dataset",uri:[i[r]]}}:void 0!==t.customConstraintNames&&t.customConstraintNames.indexOf(r)>-1?{"custom-constraint-query":{"constraint-name":r,value:i[r]}}:{"range-constraint-query":{"constraint-name":r,value:i[r]}})}function l(){var e,r=[];return o(r),null!==u&&r.push({qtext:u}),e=s.length>0?{query:{queries:[{"boost-query":{"matching-query":{"and-query":{queries:r}},"boosting-query":{"and-query":{queries:s}}}}]}}:{query:{queries:[{"and-query":{queries:r}}]}},t.includeProperties&&(e={query:{queries:[{"or-query":{queries:[e,{"properties-query":e}]}}]}}),m&&e.query.queries.push({"operator-state":{"operator-name":"sort","state-name":m}}),c&&e.query.queries.push({"operator-state":{"operator-name":"results","state-name":c}}),e}t=t||{};var s=[],i={},u=null,c="compact",m=null,d=1;return function(){t.queryOptions=t.queryOptions?t.queryOptions:"all",t.pageLength=t.pageLength?t.pageLength:10}(),{selectFacet:function(e,t){return void 0===i.facet?i[e]=[t]:i[e].push(t),this},clearFacet:function(e,t){return i[e]=i[e].filter(function(e){return e!==t}),this},clearAllFacets:function(){return i={},this},getQueryOptions:function(){return t.queryOptions},getStructuredQuery:l,search:function(){return a()},setText:function(e){return u=""!==e?e:null,this},setPage:function(e){return d=1+(e-1)*t.pageLength,this},sortBy:function(e){return m=e,this}}}this.$get=function(e,r){var n={createSearchContext:function(n){return new t(n,e,r)},getDocument:function(e,t){return(void 0===t||null===t)&&(t={}),angular.extend(t,{format:"json",uri:e}),r.get("/v1/documents",{params:t})},createDocument:function(e,t){return r.post("/v1/documents",e,{params:t})},createTriple:function(e,t){return r.post("/application/custom/sjs/createTriple.sjs",e,{params:t})},owedRevenue:function(e,t){return r.post("/application/custom/sjs/owedRevenue.sjs",e,{params:t})},taxIncentives:function(e,t){return r.post("/application/custom/sjs/taxIncentives.sjs",e,{params:t})},brandRevenue:function(e,t){return r.post("/application/custom/sjs/brandRevenue.sjs",e,{params:t})},lifestyleRevenue:function(e,t){return r.post("/application/custom/sjs/lifestyleRevenue.sjs",e,{params:t})},createSentiment:function(e,t){return r.post("/application/custom/xquery/loadTweetSentiments.xqy",e,{params:t})},updateDocument:function(t,n){var a=e.defer();return r.put("/v1/documents",t,{params:n}).success(function(e,t,r){a.resolve(r("location"))}).error(function(e){a.reject(e)}),a.promise},patch:function(t,n){var a=e.defer();return r.post("/v1/documents",n,{params:{uri:t},headers:{"X-HTTP-Method-Override":"PATCH","Content-Type":"application/json"}}).success(function(e,t,r){a.resolve(r("location"))}).error(function(e){a.reject(e)}),a.promise},advancedCall:function(t,n){var a=e.defer(),o=n.method,l="GET"===o||"PUT"===o||"POST"===o||"DELETE"===o;return o=l?o:"POST",l||(n.headers=n.headers||{},n.headers["X-HTTP-Method-Override"]=n.method),r({url:t,data:n.data,method:o,params:n.params,headers:n.headers}).success(function(e){a.resolve(e)}).error(function(e){a.reject(e)}),a.promise},callExtension:function(e,t){return this.advancedCall("/v1/resources/"+e,t)}};return n}})}();